package network

import (
	"testing"
)

// This file is for testing functions in netbios.go

func Test_parseNetBIOSResponse(t *testing.T) {
	testCases := []struct {
		name     string
		response []byte
		expected string
	}{
		{
			name: "Valid Response with one name",
			// A simplified but valid-enough response structure
			response: []byte{
				// Header (56 bytes)
				0x00, 0x00, 0x84, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00,
				0x20, 0x43, 0x4b, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41,
				0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41,
				0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x41, 0x00, 0x00, 0x21, 0x00,
				0x01, 0x00, 0x04, 0x93, 0xe0, 0x00, 0x00, 0x00,
				// Answer Section
				0x01, // Number of names: 1
				// Name 1: "MY-COMPUTER    " (Workstation Service)
				'M', 'Y', '-', 'C', 'O', 'M', 'P', 'U', 'T', 'E', 'R', ' ', ' ', ' ', ' ',
				0x00,       // Name type: Workstation
				0x04, 0x00, // Flags
			},
			expected: "MY-COMPUTER",
		},
		{
			name:     "Short response",
			response: []byte{0x01, 0x02, 0x03},
			expected: "",
		},
		{
			name: "Response with no answers",
			response: []byte{
				0x00, 0x00, 0x84, 0x00, 0x00, 0x00, 0x00, 0x00, // answers = 0
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
				0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
			},
			expected: "",
		},
		{
			name:     "Nil response",
			response: nil,
			expected: "",
		},
	}

	for _, tc := range testCases {
		t.Run(tc.name, func(t *testing.T) {
			hostname := parseNetBIOSResponse(tc.response)
			if hostname != tc.expected {
				t.Errorf("expected hostname %q, but got %q", tc.expected, hostname)
			}
		})
	}
}
